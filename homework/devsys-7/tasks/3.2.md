Домашняя работа по занятию "3.2. Работа в терминале, лекция 2"
==

1. Какого типа команда `cd`? Попробуйте объяснить, почему она именно такого типа; опишите ход своих мыслей, если
   считаете что она могла бы быть другого типа.
   
<h3>Ответ:</h3>

Команда cd на мой взгляд является встроенной командой оболочки. Поведение команды такое же как и у других, но при этом она
имеет свои особенности. Например, при выполнении команды whereis cd мы не получим ожидаемого результата с указанием пути
расположения бинарных файлов или мануалов команды cd. Но при этом поведение команды cd похоже на поведение команды cp,
а именно: 

- в stdin уходит строка; 
- команда выполняется в фоновом режиме; 
- при успешном результате ответ не возвращается; 
- если при выполнении появляется ошибка, то происходит перенаправление 2>&1.  

При выполнении команды `type` можно увидеть следующий результат:
````bash
admsec@dev:~$ type cd
cd is a shell builtin
````

---

2. Какая альтернатива без pipe команде `grep <some_string> <some_file> | wc -l`? `man grep` поможет в ответе на этот
   вопрос. Ознакомьтесь с [документом](http://www.smallo.ruhr.de/award.html) о других подобных некорректных вариантах
   использования pipe.

<h3>Ответ:</h3>

`grep -c <some_string> <some_file> `

---

3. Какой процесс с PID `1` является родителем для всех процессов в вашей виртуальной машине Ubuntu 20.04?

<h3>Ответ:</h3>

````bash
admsec@dev:~$ ps aux | head -n2
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  6.4  0.3 104844 14472 ?        Ss   15:12   0:08 /sbin/init splash
````

---

4. Как будет выглядеть команда, которая перенаправит вывод stderr `ls` на другую сессию терминала?

<h3>Ответ:</h3>

`ls <some_dir> 2> /dev/pts/<some_tty>`

---

5. Получится ли одновременно передать команде файл на stdin и вывести ее stdout в другой файл? Приведите работающий пример.

<h3>Ответ:</h3>

`cat <some_file> > <some_new_file> `

---

6. Получится ли вывести находясь в графическом режиме данные из PTY в какой-либо из эмуляторов TTY? Сможете ли вы
   наблюдать выводимые данные?

<h3>Ответ:</h3>

Да, можно вывести данные из PTY на эмулятор TTY и можно наблюдать выводимые данные на эмуляторе TTY. Проверка этого
вопроса выполнялась путем ввода команды ls с несуществующим каталогом и перенаправлением потока ошибок stderr на
эмулятор TTY /dev/tty2.

`ls /qwe 2> /dev/tty2`

---

7. Выполните команду `bash 5>&1`. К чему она приведет? Что будет, если вы выполните `echo netology > /proc/$$/fd/5`?
   Почему так происходит?

<h3>Ответ:</h3>

Команда bash 5>&1 создает дескриптор 5 (/proc/$$/fd/5) для новой сессии bash с выводом на stdout (дескриптор 1). 

Команда echo netology > /proc/$$/fd/5 перенаправляет stdin (echo netology) в файловый дескриптор /proc/$$/fd/5,
закрепленный за новым и в данный момент текущим сеансом bash.  В свою очередь файловый дескриптор /proc/$$/fd/5
перенаправляет вывод на stdout. В данном случае получается следующая цепочка перенаправления:

`stdin —> /proc/$$/fd/5 —> stdout`

---

8. Получится ли в качестве входного потока для pipe использовать только stderr команды, не потеряв при этом отображение
   stdout на pty? Напоминаем: по умолчанию через pipe передается только stdout команды слева от `|` на stdin команды
   справа. Это можно сделать, поменяв стандартные потоки местами через промежуточный новый дескриптор,
   который вы научились создавать в предыдущем вопросе.

<h3>Ответ:</h3>

`{ ls -la <DIR> 2>&3 | grep <NAME_DIR>; } 3>&1 1>&2 | tee /tmp/test `

---

9. Что выведет команда `cat /proc/$$/environ`? Как еще можно получить аналогичный по содержанию вывод?

<h3>Ответ:</h3>

Команды выведет все переменные среды окружения текущей сессии. Аналог этой команды – команда env.  

---

10. Используя `man`, опишите что доступно по адресам `/proc/<PID>/cmdline`, `/proc/<PID>/exe`.

<h3>Ответ:</h3>

/proc/<PID>/cmdline содержит командую строку указанного процесса (кроме зомби-процессов). 

Не совсем понимаю для чего это необходимо. Если отталкиваться от описания в man, то наличие в proc/<PID>/cmdline
командой строки указанного процесса сообщает, что процесс не является зомби. Так ли это? 

/proc/<PID>/exe содержит символическую ссылку, в которой указан путь к исполняемой команде (как указано в man это
актуально для ОС с версиями ядра (как я понимаю) 2.2 и выше). Если выполнить команду /proc/<PID>/exe, то выполнится
команда, закрепленная за PID.  

Пример: при выполнении команды /proc/$$/exe, выполнится команда bash.  

---

11. Узнайте, какую наиболее старшую версию набора инструкций SSE поддерживает ваш процессор с помощью `/proc/cpuinfo`.

<h3>Ответ:</h3>

`sse4_2 `

---

12. При открытии нового окна терминала и `vagrant ssh` создается новая сессия и выделяется pty. Это можно подтвердить командой `tty`, которая упоминалась в лекции 3.2. Однако:

    ```bash
	vagrant@netology1:~$ ssh localhost 'tty'
	not a tty
    ```

	Почитайте, почему так происходит, и как изменить поведение.

<h3>Ответ:</h3>

Можно перенаправить поток ввода на конкретную сессию, на который выделен нужный pty.

````bash
admsec@dev:~$ tty
/dev/pts/0
admsec@dev:~$ ssh localhost 'tty < /dev/pts/0'
admsec@localhost's password: 
/dev/pts/0
````

---

13. Бывает, что есть необходимость переместить запущенный процесс из одной сессии в другую. Попробуйте сделать это,
    воспользовавшись `reptyr`. Например, так можно перенести в `screen` процесс, который вы запустили по ошибке в
    обычной SSH-сессии.

<h3>Ответ:</h3>

<h5>reptyr</h5> 

Для воспроизведения процедуры перемещения процесса из одной сессии в другую были выполнены следующие действия: 
- Было заранее создано две сессии (pts/0 и pts/1); 
- В сессии pts/0 был выполнен вход по ssh (ssh testuser@localhost); 
- После входа была выполнена команда ping localhost для имитации непрерывного процесса;
- В сессии pts/1 выполняем команду ps -a для поиска PID процессов, не связанных с текущей сессией.  
````bash
PID TTY          TIME CMD 
2162 pts/0    00:00:00 ssh 
2220 pts/2    00:00:00 ping 
2222 pts/1    00:00:00 ps 
````
- После чего вводим команду reptyr 2162 для перемещения процесса (ssh сессии с выполнением команды ping) в сессию pts/1
  и видим как процесс ping продолжает работу.  

<h5>screen</h5>

В данной ситуации процедура аналогична предыдущей, за одним исключением. На 4 шаге предыдущего сценария мы выполняем
команду screen для создания виртуального окна терминала. И далее по такому же сценарию перенаправляем процесс в сессии
screen.  

---

14. `sudo echo string > /root/new_file` не даст выполнить перенаправление под обычным пользователем, так как
    перенаправлением занимается процесс shell'а, который запущен без `sudo` под вашим пользователем. Для решения данной
    проблемы можно использовать конструкцию `echo string | sudo tee /root/new_file`. Узнайте что делает команда `tee` и
    почему в отличие от `sudo echo` команда с `sudo tee` будет работать.

<h3>Ответ:</h3>

Команда tee читает строку из stdin и пишет ее в stdout или в файл.  

В таком случае основное отличие выполнения у команды echo string | sudo tee /root/new_file заключается в том, что мы
получаем строку от имени непривилегированного пользователя и направляем эту строку в stdin команды tee, процесс которой
запускается от имени суперпользователя.
