Домашняя работа по занятию "3.6. Компьютерные сети, лекция 1"
==

1. Необязательное задание:
можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)
   
<h3>Ответ:</h3>

Не смог подключиться. Возможно провайдер закрыл доступ подключения по порту telnet’а.
В итоге посмотрел немного в интернете. Звездные войны. 4 эпизод.

---

2. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе
   на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных
   странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный
   ответ и на этот вопрос.

<h3>Ответ:</h3>

При работе WiFi на частотном диапазоне 2.4 ГГц всего определено 14 каналов (14 канал разрешен для использования в Японии).
Из них непересекающимися каналами считаются 1, 6 и 11.

- [Источник](https://vcctv.ru/matchast/chastotnyie-polosyi-i-kanalyi-wifi-v-2.4-ghz.html)

При работе WiFi на частотном диапазоне 5 ГГц доступно 23 не пересекающихся канала по 20 МГц.

- [Источник 1](https://weblance.com.ua/227-pogovorim-o-standarte-80211ac-5-ggc-v-massy.html)
- [Источник 2](https://vcctv.ru/matchast/chastotnyie-polosyi-i-kanalyi-wifi-v-5-ghz.html)

---

3. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique
   Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?

<h3>Ответ:</h3>

Apple

---

4. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт,
   а TCP – 32 байта?

<h3>Ответ:</h3>

```
MTU >= MSS + (заголовков IPv4) + (заголовков TCP)
MSS (payload) = MTU – (заголовков IPv4) - (заголовков TCP)
Payload = 9001 – 20 – 32 = 8949 байт
```

---

5. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети?
   Почему да или нет?

<h3>Ответ:</h3>

Учитывая, что в вопросе указано «при штатном режиме работы», мое мнение, что одновременно эти флаги не могут быть
установлены. Почему такое мнение? Дальнейший текст является полетом мысли и возможно будут определенные нестыковки в
терминах или еще в чем-то.

У TCP соединений есть определенные состояния:
- прослушивание;
- установка соединения;
- установленное соединение с возможностью передачи данных;
- закрытие соединения.

Флаг SYN используется для открытия соединения. А флаг FIN для закрытия соединения. А между открытием соединения и его
закрытием еще необходимо передать данные. Таким образом использовать флаг FIN не получиться до тех пор, пока соединение
не будет установлено (то есть пока не пройдет этап трехкратного рукопожатия).

---

6. `ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?

<h3>Ответ:</h3>

Приведенная команда должна выводить информацию о состоянии UDP соединения по порту 53 (DNS).
Состояние TIME-WAIT в данном случае присутствовать не будет, так как соединение UDP не подразумевает собой процедуру
установки и закрытия соединения. Оно может быть в состоянии (LISTEN, ESTAB …).

Состояние TIME-WAIT может присутствовать, в случае, если разговор идет о TCP соединении, и если до этого по этому порту
было установлено соединение (ESTAB). После закрытия соединения у сокета будет состояние TIME-WAIT определенное время
(в интернете вычитал про термин 2MSL – две максимальные продолжительности существования сегмента).


---

7. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

<h3>Ответ:</h3>


---

8. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения.
   Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно
   может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер
   от одного клиента? А если клиентов больше одного?

<h3>Ответ:</h3>

Каждое соединение идентифицируется следующими параметрами:
- IP адрес клиента;
- Порт клиента;
- IP адрес сервера;
- Порт сервера.

Общее количество возможно используемых портов 65535 (216 – 1, где 16 – это поля source port и destination port в
заголовке TCP header, а -1 потому что порты начинаются с 0).

Если на уровне L4 никаких ограничений нет, то максимальное число соединений в случаях подключения клиента с одного IP
адреса к серверу с одним IP адресом и обслуживание сервера от одного клиента, а также для каждого нового клиента 
будет доступно 65535 соединений.

На практике я думаю, такого конечно нет.

---

9. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии `TIME-WAIT`?
   Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

<h3>Ответ:</h3>

Такая ситуация может быть. Нельзя сказать, что ситуация хорошая или плохая, так как особенность состояния `TIME-WAIT`
заключается в том, чтобы указать на корректное закрытие соединения. Состояние хранится на сервере определенно заданное
время 2MSL (частично об этом написано в ответе на вопрос `6`). Это состояние сохраняет сокет в случае, если какие-то
сегменты «потерялись». В случае необходимости новых подключений могут использоваться эфемерные порты.
Если эфемерных портов будет недостаточно, то можно уменьшить время состояния `TIME-WAIT`.

---

10. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

<h3>Ответ:</h3>

Отличие между TCP и UDP это то, что UDP не гарантирует доставку ip пакетов.
В случае если будет выполнена фрагментация UDP, необходимо быть уверенным, что все промежуточные роутеры и хост
поддерживают эту фрагментацию. В противном случае ip пакеты не будут доставлены.

---

11. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

<h3>Ответ:</h3>

<h4>Вариант 1:</h4>

Как основной использовал бы протокол TCP при условиях, что хосты работают в штатном режиме. Таким образом, можно
(возможно) быть уверенным, что все логи приходят без потерь. А при появлении определенных условий (изменения состояния),
которые указывают на увеличение нагрузки хостов и могут вызвать сбои в работе, настроил бы автоматический переход сбора
логов по протоколу UDP.

<h4>Вариант 2:</h4>

Как основной использовал бы протокол UDP и в таком случае получал бы актуальную информацию без задержек.
А по протоколу TCP можно получать какие-то определенные логи (работу конкретных сервисов и тд).

---

12. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

<h3>Ответ:</h3>

````bash
vagrant@vagrant:~$ sudo netstat -apt4
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:sunrpc          0.0.0.0:*               LISTEN      1/init
tcp        0      0 localhost:domain        0.0.0.0:*               LISTEN      597/systemd-resolve
tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN      771/sshd: /usr/sbin
tcp        0      0 vagrant:ssh             _gateway:52008          ESTABLISHED 1194/sshd: vagrant
vagrant@vagrant:~$ sudo ss -tp state listening
Recv-Q Send-Q Local Address:Port   Peer Address:PortProcess
0      4096         0.0.0.0:sunrpc      0.0.0.0:*    users:(("rpcbind",pid=596,fd=4),("systemd",pid=1,fd=35))
0      4096   127.0.0.53%lo:domain      0.0.0.0:*    users:(("systemd-resolve",pid=597,fd=13))
0      128          0.0.0.0:ssh         0.0.0.0:*    users:(("sshd",pid=771,fd=3))
0      4096            [::]:sunrpc         [::]:*    users:(("rpcbind",pid=596,fd=6),("systemd",pid=1,fd=37))
0      128             [::]:ssh            [::]:*    users:(("sshd",pid=771,fd=4))
````
Порты указаны в столбцах local address. Процессы указаны в столбцах PID/Program name, Process.

---

13. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в
    текстовом виде? А в текстовом и шестнадцатиричном?

<h3>Ответ:</h3>

- `-e` – вывод содержимого фреймов в текстовом виде.
- `-X` – вывод в текстовом и шестнадцатеричном виде.

---

14. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть
    его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные
    флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется
    стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

<h3>Ответ:</h3>

<h4>Сбор трафика:</h4>

````bash
vagrant@vagrant:~$ sudo tcpdump -c100 -w test
tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
100 packets captured
100 packets received by filter
0 packets dropped by kernel
````
Анализ трафика выполнялся с помощью Wireshark.

<h4>Флаги IP:</h4>

````
Flags: 0x4000, Don’t fragment
0...  .... .... ....    = Reserved bit: No set
.1.. .... .... ....     = Don’t fragment: Set
..0. .... .... ....     = More fragments: No set
````

- Первый бит зарезервирован и должен быть всегда равен нулю.
- второй бит DF (don’t fragment) определяет возможность фрагментации пакета
  (в данном случае фрагментация не допускается).
- третий бит MF (more fragments) показывает, не является ли этот пакет последним в цепочке пакетов
  (в данном случае 0 говорит о том, что пакет не разделялся).

<h4>Стандарт Ethernet:</h4>

````
IEEE 802.3 Ethernet
````

<h4>OUI:</h4>

````
Destination: ASUSTeckC_ad:a1:3b (d0:17:c2:ad:a1:3b)
    Address: ASUSTeckC_ad:a1:3b (d0:17:c2:ad:a1:3b)
Source: Ubiquiti_3c:1c:93 (24:a4:3c:3c:1c:93)
    Address: Ubiquiti_3c:1c:93 (24:a4:3c:3c:1c:93)
````

OUI:
- ASUSTeckC (d0:17:c2)
- Ubiquiti (24:a4:3c)
