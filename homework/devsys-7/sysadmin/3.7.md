Домашняя работа по занятию "3.7. Компьютерные сети, лекция 2"
==

1. На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера
   участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например,
   если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США.
   [Здесь](https://www.cloudping.co/grid) вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого
   размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов).
   Можно воспользоваться готовым [калькулятором](https://www.switch.ch/network/tools/tcp_throughput/). Ознакомиться
   с [формулами](https://en.wikipedia.org/wiki/TCP_tuning), по которым работает калькулятор можно, например, на Wiki.

<h3>Ответ:</h3>

````
RWND = throughput * RTT
RWND = 1024 Mbit/sec * 0.3 sec = 307.2 Mbit = 307 200 000 bit = 3840 byte
````

---

2. Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?

<h3>Ответ:</h3>
Все расчеты проводились с помощью [калькулятора](https://www.switch.ch/network/tools/tcp_throughput/) по формуле:

````
throughput = (MSS/RTT)*(C/sqrt(Loss))
````
Установим следующие характеристики:

````
MSS = 1560 byte
RTT = 80 ms
````
Тогда пропускная способность без потерь будет равна `1460.00 Mbit/sec`.

При 1% потерь пакетов при передаче пропускная способность будет равна `1.46 Mbit/sec`.
Из этого можно сделать вывод, что при 1% потерь пакетов при передаче пропускная способность канала упадет в 1000 раз.

---

3. Какая максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload,
   то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов.
   Повлияет ли размер фрейма на это?
   
<h3>Ответ:</h3>

По формуле `throughput = (MSS/RTT)*(C/sqrt(Loss))` видно, что чем больше `MSS`, тем больше пропускная способность.
Размер фрейма в свою очередь можно представить в виде:

`Frame = MTU + Ethernet header + Ethernet trailer` (1)

MTU можно представить в виде:

`MTU = MSS + TCP header + IP header` (2)

Если в формулу (1) подставить формулу (2), тогда получим:

`Frame = MSS + TCP header + IP header + Ethernet header + Ethernet trailer` (3)

Отсюда следует, что чем больше MSS, тем больше throughput и Frame.

Следовательно, размер фрейма влияет на скорость передачи данных. 

---

4. Что на самом деле происходит, когда вы открываете сайт? :)
   На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в
   частности про IP адресацию, DNS и т.д. Опишите максимально подробно насколько вы это можете сделать, что происходит,
   когда вы делаете запрос `curl -I http://netology.ru` с вашей рабочей станции. Предположим, что arp кеш очищен,
   в локальном DNS нет закешированных записей.
   
<h3>Ответ:</h3>

При вызове в терминале команды curl мы пытаемся установить TCP-соединение (протокол `http` использует TCP) с сервером
по адресу `http://netology.ru` по `80` порту. А так как наша рабочая станция не знает с кем нужно открыть соединение
(пустая ARP-таблица) и какой ip-адрес принадлежит `http://netology.ru` (нет закешированных записей DNS), будут выполнены
следующие итерации:

- поиск ip-адреса, принадлежащий адресу `http://netology.ru`:
  - рабочая станция не имеет DNS-записи, поэтому будет отправлен запрос DNS-серверу. Но чтобы его отправить необходимо
    узнать как до не добраться. Поэтому перед этой итерацией будет выполнено следующее:
    - рабочая станция знает ip-адрес шлюза, но не знает его MAC-адрес для чего будет отправлен широковещательный
      ARP-запрос для поиска соответствия ip- и MAC- адресов шлюза. После того как это соответствие будет установлено, в
      ARP-таблице появится соответствующая запись (пример: `_gateway (192.168.31.254) at 24:a4:3c:3c:1c:93 [ether] 
      on ens33`)
  - так как DNS- и WEB- сервера находятся за пределами нашей сети, все дальнейшие запросы будут проходить через
    шлюз по-умолчанию.
  - далее будет отправлен рекурсивный запрос по протоколу UDP для поиска ip-адреса. Пример поиска ip-адреса можно
    увидеть командой `dig +trace www.netology.ru` (вывод аналогичен ответу на вопрос 5).
  - в результате адрес доступен по следующим ip-адресам:
    ````bash
    admsec@dev:~$ nslookup -type=a www.netology.ru
    Server:		127.0.0.53
    Address:	127.0.0.53#53
    
    Non-authoritative answer:
    Name:	www.netology.ru
    Address: 104.22.48.171
    Name:	www.netology.ru
    Address: 172.67.43.83
    Name:	www.netology.ru
    Address: 104.22.49.171
    ````
- после того как мы узнали ip-адрес `http://netology.ru` curl попытается установить TCP-соединение. Если handshake
  пройдет успешно, то с нашей рабочей станции на WEB-сервер отправится http-заголовок вида:
  ````
  GET / HTTP/1.1
  Host: netology.ru
  ````
- после отправки заголовка TCP-соединение будет закрыто. В свою очередь WEB-сервер после обработки запроса подготовит
  ответ и будет устанавливать TCP-соединение с нашей рабочей станцией для передачи. Этот процесс работает таким же
  образом.
- после получения данных с WEB-сервера в окне терминала появится ответ на наш запрос:
  ````bash
  admsec@dev:~$ curl -I http://netology.ru
  HTTP/1.1 301 Moved Permanently
  Date: Wed, 21 Apr 2021 12:43:16 GMT
  Connection: keep-alive
  Cache-Control: max-age=3600
  Expires: Wed, 21 Apr 2021 13:43:16 GMT
  Location: https://netology.ru/
  cf-request-id: 09960ddcc30000498926b9c000000001
  Server: cloudflare
  CF-RAY: 6436b2746fe74989-DME
  alt-svc: h3-27=":443"; ma=86400, h3-28=":443"; ma=86400, h3-29=":443"; ma=86400
  ````

---

5. Сколько и каких итеративных запросов будет сделано при резолве домена `www.google.co.uk`?

<h3>Ответ:</h3>
В моем случае было 4 запроса:

- `127.0.0.53`
- `m.root-servers.net`
- `dns2.nic.uk`
- `ns1.google.com`

````bash
admsec@dev:~$ dig +trace www.google.co.uk

; <<>> DiG 9.16.1-Ubuntu <<>> +trace www.google.co.uk
;; global options: +cmd
.			32425	IN	NS	a.root-servers.net.
.			32425	IN	NS	b.root-servers.net.
.			32425	IN	NS	c.root-servers.net.
.			32425	IN	NS	d.root-servers.net.
.			32425	IN	NS	e.root-servers.net.
.			32425	IN	NS	f.root-servers.net.
.			32425	IN	NS	g.root-servers.net.
.			32425	IN	NS	h.root-servers.net.
.			32425	IN	NS	i.root-servers.net.
.			32425	IN	NS	j.root-servers.net.
.			32425	IN	NS	k.root-servers.net.
.			32425	IN	NS	l.root-servers.net.
.			32425	IN	NS	m.root-servers.net.
;; Received 262 bytes from 127.0.0.53#53(127.0.0.53) in 4 ms

uk.			172800	IN	NS	nsc.nic.uk.
uk.			172800	IN	NS	dns2.nic.uk.
uk.			172800	IN	NS	dns4.nic.uk.
uk.			172800	IN	NS	dns1.nic.uk.
uk.			172800	IN	NS	nsd.nic.uk.
uk.			172800	IN	NS	nsa.nic.uk.
uk.			172800	IN	NS	dns3.nic.uk.
uk.			172800	IN	NS	nsb.nic.uk.
uk.			86400	IN	DS	43876 8 2 A107ED2AC1BD14D924173BC7E827A1153582072394F9272BA37E2353 BC659603
uk.			86400	IN	RRSIG	DS 8 1 86400 20210502050000 20210419040000 14631 . VEj9FhQEZVNJILUNj6FCVvfc/iK9iNn/IwVuik4fE2a3pwLt8nOOgMJq je5qg32/OI1e8t34EQha19XDKyCyQKOYHCQBLRN39UR0N+Obx4q6V3rW Wwx1x+MR8VqoLR1ExdApvYc/qQkoH0qroFalBGwBPdjMeJWcjeuNtkcu WmmQGM3U8PbxDifa9oBjKi9a7Xxy+9n7fhfjx8nwsGP//5ZzfIST058+ qQaeTB9QsXmhlNNWaTcQqMS033mIwd6vmxTTuSitz8MqRcMoAslAF/2F 2VSBZopgtQOiKYdSfSb/dKo6D5MUZJlssJv2oaQnr47gm3BCyq9IuJDZ 9LZwDw==
;; Received 800 bytes from 202.12.27.33#53(m.root-servers.net) in 40 ms

google.co.uk.		172800	IN	NS	ns1.google.com.
google.co.uk.		172800	IN	NS	ns2.google.com.
google.co.uk.		172800	IN	NS	ns3.google.com.
google.co.uk.		172800	IN	NS	ns4.google.com.
g9f1kiihm8m9vhjk7lrvetbqceogjiqp.co.uk.	10800 IN NSEC3 1 1 0 - G9F5O8Q1LBTUKBV4FRD3PU0HUIPAP422 NS SOA RRSIG DNSKEY NSEC3PARAM TYPE65534
g9f1kiihm8m9vhjk7lrvetbqceogjiqp.co.uk.	10800 IN RRSIG NSEC3 8 3 10800 20210519135744 20210414132353 33621 co.uk. JQaid++zYq3OyoPgpkat7f5z6IEZhfXynCdGjPbqGzH+sJGcHto+yThG bNPin3w7GIuUXAf+OBAxANegN/18AzK9Q0R4FCgICKaVJx28a2EfQtXi Wgu8tlsZVtH0uvnG3EeDMGdroeLJj8Job48ia5XEjxUipggpZtaMba/D 5gs=
6qek9gotc8rl190u20rppm84phaaco0t.co.uk.	10800 IN NSEC3 1 1 0 - 6QF16S089GRU386I3JOL1T2E5CV61060 NS DS RRSIG
6qek9gotc8rl190u20rppm84phaaco0t.co.uk.	10800 IN RRSIG NSEC3 8 3 10800 20210523030853 20210418021834 33621 co.uk. uZwZbVjEmI+WKB4RB3ceKHhizlJ0e6EmMZs0cJtM3eNjtAcorKSZEU+W 5OMoc7DUON4UrAgmKkIsM9TDFeB4ccc88qlC8lHK5kUco/vGC9lTQ1Vx uLCPLH7cN8S94Mq5AgwDSU+f7ta86oKdzOjLMu3kaciZFPNFSvVQqvRh XKs=
;; Received 650 bytes from 103.49.80.1#53(dns2.nic.uk) in 48 ms

www.google.co.uk.	300	IN	A	173.194.73.94
;; Received 61 bytes from 216.239.32.10#53(ns1.google.com) in 40 ms
````

---

6. Сколько доступно для назначения хостам адресов в подсети `/25`? А в подсети с маской `255.248.0.0`.
   Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.
   
<h3>Ответ:</h3>

В маске подсети часть, заполненная `0`, является адресным пространством. Таким образом:
````
максимальный размер маски - текущая маска = адресное пространство
````
Чтобы узнать количество адресов в адресном пространстве необходимо число 2 возвести в степень `адресного пространства`.
````
2pow(адресное пространоство) = количество адресов
````
Для подсети `/25` доступно `128 адресов`:
````
32 - 25 = 7
2 в степени 7 = 128
````
В подсети с маской `255.248.0.0` доступно `524 288 адресов`:
- октет 255 в двоичной системе имеет 8 единиц
- октет 248 в двоичной системе имеет 5 единиц
````
32 - (8 + 5) = 19
2 в степени 19 = 524 288
````

---

7. В какой подсети больше адресов, в `/23` или `/24`?

<h3>Ответ:</h3>

В подсети `/23` больше адресов, чем в `/24`.

Чем меньше маска подсети, тем больше адресное пространство. 
Отталкиваясь от ответа на вопрос `6` можно подсчитать количество адресов.

Для подсети `/23`:
````
32 - 23 = 9
2 в степени 9 = 512
````
Для подсети `/24`:
````
32 - 24 = 8
2 в степени 8 = 256
````
---

8. Получится ли разделить диапазон `10.0.0.0/8` на 128 подсетей по 131070 адресов в каждой? Какая маска будет у
   таких подсетей?
   
<h3>Ответ:</h3>

Сеть с маской `/8` поддерживает 16 777 216 адресов:
````
32 - 8 = 24
2 в степени 24 = 16 777 216
````
Для каждой подсети доступно 131 072 адреса:
````
16 777 216 / 128 = 131 072
````
Маска для каждой подсети будет равна `/17`:
````
2 в степени 17 = 131 072
````
В итоге диапазон `10.0.0.0/8` можно разделить на 128 подсетей по 131070 адресов в каждой
(плюс два адреса в каждой подсети в резерве). Маской каждой из подсети будет равна `/17`.